<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- v1.1.0-20251219-0200 -->
    <title>DartStream Stats Platform - Multi-Organization Darts Statistics</title>
    <meta name="description" content="Atlantic Amateur Darts Series - Comprehensive statistics, head-to-head, player analysis, and form tracking">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéØ</text></svg>">
    
    <!-- Supabase CDN -->
    <script src="https://unpkg.com/@supabase/supabase-js@2?v=20251219020000"></script>
    <script>window.ADMIN_VERSION = '1.1.0-20251219-0200';</script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 215, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .header h1 {
            color: #ffd700;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            gap: 8px;
        }

        .nav-tab {
            background: transparent;
            border: none;
            color: #e0e0e0;
            padding: 12px 18px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
        }

        .nav-tab.active {
            background: #ffd700;
            color: #1a1a1a;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .card h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ffd700;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
        }

        .form-control:focus {
            outline: none;
            border-color: #ffd700;
        }

        .btn {
            padding: 12px 30px;
            background: #ffd700;
            color: #1a1a1a;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #ffed4e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }

        .btn-secondary:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        select.form-control {
            cursor: pointer;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .quick-start-banner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
            border: 2px solid var(--primary-gold);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .quick-start-banner h2 {
            color: var(--primary-gold);
            font-size: 2em;
            margin-bottom: 15px;
        }

        .quick-start-banner p {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .quick-start-btn {
            display: inline-block;
            padding: 15px 40px;
            background: var(--primary-gold);
            color: #1a1a1a;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .quick-start-btn:hover {
            background: #ffed4e;
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .stats-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .stats-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .stats-table tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .stat-card {
            background: rgba(255, 215, 0, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
            display: block;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #b0b0b0;
            font-size: 0.9em;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .vs-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 30px 0;
        }

        .player-card {
            flex: 1;
            background: rgba(255, 215, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .player-card h3 {
            color: #ffd700;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .vs-divider {
            font-size: 2em;
            color: #ffd700;
            margin: 0 20px;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .loading-spinner {
            border: 3px solid rgba(255, 215, 0, 0.1);
            border-top: 3px solid #ffd700;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #f55;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .rank-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .rank-1 { background: #ffd700; color: #1a1a1a; }
        .rank-2 { background: #c0c0c0; color: #1a1a1a; }
        .rank-3 { background: #cd7f32; color: #1a1a1a; }

        .bracket-container {
            display: flex;
            gap: 40px;
            overflow-x: auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .bracket-round {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            min-width: 200px;
        }

        .bracket-round h3 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .bracket-match {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
        }

        .bracket-player {
            padding: 8px;
            margin: 3px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bracket-player.winner {
            background: rgba(255, 215, 0, 0.2);
            font-weight: bold;
            border-left: 3px solid #ffd700;
        }

        .bracket-player .score {
            color: #ffd700;
            font-weight: bold;
            margin-left: 10px;
        }

        .champion-banner {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .champion-banner .trophy {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .position-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 2px;
        }

        .pos-champion { background: #ffd700; color: #1a1a1a; }
        .pos-runner-up { background: #c0c0c0; color: #1a1a1a; }
        .pos-3rd { background: #cd7f32; color: #1a1a1a; }
        .pos-5th { background: rgba(100, 149, 237, 0.5); color: #fff; }
        .pos-9th { background: rgba(70, 130, 180, 0.5); color: #fff; }

        .achievement-card {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .achievement-card h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .achievement-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .achievement-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .vs-container {
                flex-direction: column;
            }
            
            .vs-divider {
                margin: 15px 0;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Screen (Login/Signup) -->
    <div id="authScreen" class="container" style="display: none;">
        <div class="header">
            <img src="dartstream-logo.png" alt="DartStream Logo" style="max-width: 300px; max-height: 100px; margin-bottom: 15px;">
            <h1>üéØ DartStream Stats Platform</h1>
            <p>Multi-Organization Darts Statistics & Display System</p>
        </div>
        
        <div class="card" style="max-width: 550px; margin: 50px auto;">
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button id="showLoginBtn" class="btn" onclick="showAuthForm('login')" style="flex: 1; background: #ffd700; color: #000;">üîì Login</button>
                <button id="showSignupBtn" class="btn" onclick="showAuthForm('signup')" style="flex: 1; background: transparent; border: 1px solid #ffd700; color: #ffd700;">‚ú® Create Account</button>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" style="display: block;">
                <h2>üîê Login to Your Account</h2>
                <p style="margin-bottom: 20px; color: #888;">Access your organization's stats dashboard</p>
                
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="your@email.com">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Enter password">
                </div>
                
                <button class="btn" onclick="handleLogin()" style="width: 100%;">
                    üîì Sign In
                </button>
                
                <div id="loginStatus" style="margin-top: 15px;"></div>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" style="display: none;">
                <h2>‚ú® Create Your Organization Account</h2>
                <p style="margin-bottom: 20px; color: #888;">Get your own customizable stats display system</p>
                
                <div class="form-group">
                    <label for="signupOrgName">Organization Name *</label>
                    <input type="text" id="signupOrgName" class="form-control" placeholder="Your Organization Name">
                </div>
                
                <div class="form-group">
                    <label for="signupEmail">Email Address *</label>
                    <input type="email" id="signupEmail" class="form-control" placeholder="admin@yourorg.com">
                </div>
                
                <div class="form-group">
                    <label for="signupPassword">Password *</label>
                    <input type="password" id="signupPassword" class="form-control" placeholder="Min 6 characters">
                </div>
                
                <div class="form-group">
                    <label for="signupPasswordConfirm">Confirm Password *</label>
                    <input type="password" id="signupPasswordConfirm" class="form-control" placeholder="Re-enter password">
                </div>
                
                <button class="btn" onclick="handleSignup()" style="width: 100%;">
                    ‚ú® Create Account & Setup Organization
                </button>
                
                <div id="signupStatus" style="margin-top: 15px;"></div>
                
                <div style="margin-top: 20px; padding: 12px; background: rgba(100, 149, 237, 0.1); border: 1px solid rgba(100, 149, 237, 0.3); border-radius: 5px;">
                    <p style="color: #6495ED; font-size: 0.9em; line-height: 1.6; margin: 0;">
                        ‚ÑπÔ∏è You'll get your own customizable stats display, scraper interface, and full control over colors, logos, and settings.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Admin Interface -->
    <div id="adminInterface" class="container" style="display: none;">
        <div class="header">
        <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.9); color: #FF6B00; padding: 6px 12px; border-radius: 15px; font-size: 10px; border: 1px solid rgba(255, 107, 0, 0.5); box-shadow: 0 2px 8px rgba(255, 107, 0, 0.3); z-index: 10000;">üéØ v1.1.0-20251219-0200</div>
        <button onclick="handleLogout()" style="position: absolute; top: 10px; left: 10px; background: rgba(255, 69, 0, 0.2); color: #ff6b00; border: 1px solid rgba(255, 107, 0, 0.5); padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 12px;">
            üö™ Logout
        </button>
            <img src="dartstream-logo.png" alt="DartStream Logo" style="max-width: 300px; max-height: 80px; margin-bottom: 10px;">
            <h1>üéØ <span id="orgName">DartStream</span> Statistics Center</h1>
            <p id="orgSubtitle">Multi-Organization Darts Stats Platform</p>
            <p style="font-size: 0.9em; color: #888; margin-top: 5px;">Logged in as: <span id="userEmail"></span> | <a href="#" onclick="showTab('settings'); return false;" style="color: #6495ED;">‚öôÔ∏è Settings</a></p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('leaderboard')">Leaderboard</button>
            <button class="nav-tab" onclick="showTab('events')" style="background: rgba(255, 215, 0, 0.2); font-weight: bold; animation: pulse 2s infinite;">üîÑ Event Manager (Scrape Here)</button>
            <button class="nav-tab" onclick="showTab('embed')">üì∫ Embed & Share</button>
            <button class="nav-tab" onclick="showTab('eventDetails')">Event Details</button>
            <button class="nav-tab" onclick="showTab('achievements')">Achievements</button>
            <button class="nav-tab" onclick="showTab('allStats')">All Stats</button>
            <button class="nav-tab" onclick="showTab('headToHead')">Head-to-Head</button>
            <button class="nav-tab" onclick="showTab('playerStats')">Player Analysis</button>
            <button class="nav-tab" onclick="showTab('form')">Current Form</button>
            <button class="nav-tab" onclick="showTab('settings')" style="background: rgba(100, 149, 237, 0.2);">‚öôÔ∏è Settings</button>
        </div>

        <!-- Leaderboard Tab -->
        <div id="leaderboard" class="tab-content active">
            <div class="quick-start-banner">
                <h2>üéØ Need to Upload Event Stats?</h2>
                <p>
                    Click the <strong>"Event Manager (Scrape Here)"</strong> tab above to enter your event URL and scrape match statistics.<br>
                    Data will automatically appear here and on the public stats display!
                </p>
                <button class="quick-start-btn" onclick="showTab('events'); document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.nav-tab')[1].classList.add('active');">
                    üîÑ Go to Event Manager ‚Üí
                </button>
            </div>

            <div class="card">
                <h2>üèÜ Overall Leaderboard</h2>
                <div id="leaderboardContent" class="loading">
                    <div class="loading-spinner"></div>
                    Loading leaderboard...
                </div>
            </div>
        </div>

        <!-- Event Manager Tab -->
        <div id="events" class="tab-content">
            <div class="card" style="background: rgba(0, 100, 255, 0.1); border: 1px solid rgba(0, 150, 255, 0.3);">
                <h2 style="color: #4a9eff;">‚ÑπÔ∏è How It Works</h2>
                <p style="margin-bottom: 15px; line-height: 1.6;">
                    <strong>1.</strong> Enter event URL and number below<br>
                    <strong>2.</strong> Click "Extract & Scrape Event" to upload data to database<br>
                    <strong>3.</strong> Stats automatically appear on the public display page<br>
                    <strong>4.</strong> Public page updates within seconds of scraping
                </p>
                <a href="stats-display.html" target="_blank" rel="noopener" 
                   style="display: inline-block; padding: 10px 20px; background: #4a9eff; color: white; 
                          text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 10px;">
                    üì∫ View Public Stats Display
                </a>
            </div>

            <div class="card">
                <h2>üìÖ Event Manager</h2>
                <div class="form-group">
                    <label for="eventUrl">Event URL</label>
                    <input type="text" id="eventUrl" class="form-control" 
                           placeholder="https://tv.dartconnect.com/event/mt_joe6163l_1">
                </div>
                <div class="form-group">
                    <label for="eventNumber">Event Number</label>
                    <input type="number" id="eventNumber" class="form-control" 
                           placeholder="1" min="1" max="7">
                </div>
                <button class="btn" onclick="scrapeEvent()">üîÑ Extract & Scrape Event</button>
                <div id="eventStatus"></div>
            </div>

            <div class="card">
                <h2>üìã All Events</h2>
                <div id="eventsListContent" class="loading">
                    Click load to see events...
                </div>
                <button class="btn btn-secondary" onclick="loadEventsList()" style="margin-top: 15px;">
                    üîÑ Refresh Events List
                </button>
            </div>

            <div class="card" style="background: rgba(255, 69, 0, 0.1); border: 1px solid rgba(255, 69, 0, 0.3);">
                <h2 style="color: #ff4444;">‚ö†Ô∏è Delete Event</h2>
                <p style="margin-bottom: 15px; line-height: 1.6; color: #ffaa00;">
                    <strong>Warning:</strong> Deleting an event will permanently remove all associated data including matches, performances, and statistics. This action cannot be undone!
                </p>
                <div style="background: rgba(100, 149, 237, 0.1); border: 1px solid rgba(100, 149, 237, 0.3); padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h3 style="color: #6495ED; margin-top: 0;">‚ÑπÔ∏è Setup Required</h3>
                    <p style="margin-bottom: 10px; line-height: 1.6;">
                        To enable event deletion, you need to configure Supabase policies:
                    </p>
                    <ol style="margin-left: 20px; line-height: 1.8;">
                        <li>Go to your <a href="https://supabase.com/dashboard/project/kswwbqumgsdissnwuiab/auth/policies" target="_blank" style="color: #6495ED;">Supabase Dashboard ‚Üí Authentication ‚Üí Policies</a></li>
                        <li>Select the <strong>events</strong> table</li>
                        <li>Click "New Policy" ‚Üí "Create policy from scratch"</li>
                        <li>Name: <code>Allow public delete</code></li>
                        <li>Policy command: <strong>DELETE</strong></li>
                        <li>Target roles: <strong>public</strong></li>
                        <li>USING expression: <code>true</code></li>
                        <li>Click "Save"</li>
                    </ol>
                    <p style="margin-top: 10px; line-height: 1.6; color: #ffaa00;">
                        <strong>Note:</strong> This allows anyone to delete events. For better security, consider adding authentication or restricting by user.
                    </p>
                </div>
                <div class="form-group">
                    <label for="deleteEventNumber">Select Event to Delete</label>
                    <select id="deleteEventNumber" class="form-control">
                        <option value="">-- Select an event --</option>
                    </select>
                </div>
                <button class="btn" onclick="confirmDeleteEvent()" style="background: #ff4444; border-color: #ff4444;">
                    üóëÔ∏è Delete Selected Event
                </button>
                <div id="deleteEventStatus" style="margin-top: 15px;"></div>
            </div>
        </div>

        <!-- Embed & Share Tab -->
        <div id="embed" class="tab-content">
            <div class="card">
                <h2>üì∫ Embed Stats Display on Your Website</h2>
                <p style="margin-bottom: 20px; line-height: 1.6;">
                    Use the code below to embed the professional stats display on your personal website, 
                    tournament pages, or any other site. The embedded display will automatically show 
                    the latest stats and update in real-time.
                </p>

                <h3 style="color: #ffd700; margin-top: 30px;">üîó Direct Link</h3>
                <p>Share this link with fans and players:</p>
                <div class="form-group">
                    <input type="text" id="directLink" class="form-control" 
                           value="https://dowdarts.github.io/aadsstatsscrapper/stats-display.html" readonly>
                    <button class="btn" onclick="copyToClipboard('directLink')" style="margin-top: 10px;">
                        üìã Copy Link
                    </button>
                </div>

                <h3 style="color: #ffd700; margin-top: 30px;">üì¶ Basic Embed Code</h3>
                <p>Copy and paste this into your website's HTML:</p>
                <div class="form-group">
                    <textarea id="embedCode" class="form-control" readonly style="font-family: monospace; height: 120px; background: #000; color: #0f0; padding: 15px;">&lt;iframe 
    src="https://dowdarts.github.io/aadsstatsscrapper/stats-display.html" 
    width="100%" 
    height="800px" 
    frameborder="0"
    style="border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);"&gt;
&lt;/iframe&gt;</textarea>
                    <button class="btn" onclick="copyToClipboard('embedCode')" style="margin-top: 10px;">
                        üìã Copy Embed Code
                    </button>
                </div>

                <h3 style="color: #ffd700; margin-top: 30px;">üì± Responsive Embed Code (Recommended)</h3>
                <p>This version automatically adjusts to different screen sizes:</p>
                <div class="form-group">
                    <textarea id="responsiveCode" class="form-control" readonly style="font-family: monospace; height: 150px; background: #000; color: #0f0; padding: 15px;">&lt;div style="position: relative; padding-bottom: 75%; height: 0; overflow: hidden;"&gt;
    &lt;iframe 
        src="https://dowdarts.github.io/aadsstatsscrapper/stats-display.html" 
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; border-radius: 8px;"&gt;
    &lt;/iframe&gt;
&lt;/div&gt;</textarea>
                    <button class="btn" onclick="copyToClipboard('responsiveCode')" style="margin-top: 10px;">
                        üìã Copy Responsive Code
                    </button>
                </div>

                <h3 style="color: #ffd700; margin-top: 30px;">üëÅÔ∏è Live Preview</h3>
                <p>See how the embedded stats display looks:</p>
                <div style="border: 2px solid #ffd700; border-radius: 10px; overflow: hidden; margin-top: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                    <iframe src="stats-display.html" 
                            width="100%" 
                            height="600px" 
                            frameborder="0"
                            title="AADS Stats Display Preview">
                    </iframe>
                </div>
                
                <div style="background: rgba(0, 150, 255, 0.1); border: 1px solid rgba(0, 150, 255, 0.3); padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h3 style="color: #4a9eff;">üí° Tips for Embedding</h3>
                    <ul style="line-height: 1.8;">
                        <li>The embedded display updates automatically every 5 minutes</li>
                        <li>Works on all modern browsers and mobile devices</li>
                        <li>Adjust the <code>height</code> value (e.g., 800px, 1000px) to fit your page layout</li>
                        <li>The display is read-only - visitors cannot modify data</li>
                        <li>Perfect for league websites, tournament pages, and promotional materials</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Event Details Tab -->
        <div id="eventDetails" class="tab-content">
            <div class="card">
                <h2>üèÜ Event Details & Results</h2>
                <div class="form-group">
                    <label for="eventDetailsSelect">Select Event</label>
                    <select id="eventDetailsSelect" class="form-control" onchange="loadEventDetails()">
                        <option value="">Choose an event...</option>
                        <option value="1">Event 1</option>
                        <option value="2">Event 2</option>
                        <option value="3">Event 3</option>
                    </select>
                </div>
                <div id="eventDetailsContent"></div>
            </div>
        </div>

        <!-- Achievements Tab -->
        <div id="achievements" class="tab-content">
            <div class="card">
                <h2>üèÖ Player Achievements & Best Positions</h2>
                <div id="achievementsContent" class="loading">
                    <div class="loading-spinner"></div>
                    Loading achievements...
                </div>
            </div>
        </div>

        <!-- All Stats Tab -->
        <div id="allStats" class="tab-content">
            <div class="card">
                <h2>üìä Filtered Statistics View</h2>
                <div class="filter-row">
                    <div class="form-group">
                        <label for="filterSeries">Series</label>
                        <select id="filterSeries" class="form-control" onchange="loadFilteredStats()">
                            <option value="all">All Series</option>
                            <option value="1">Series 1</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterEvent">Event</label>
                        <select id="filterEvent" class="form-control" onchange="loadFilteredStats()">
                            <option value="all">All Events</option>
                            <option value="1">Event 1</option>
                            <option value="2">Event 2</option>
                            <option value="3">Event 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterStage">Stage</label>
                        <select id="filterStage" class="form-control" onchange="loadFilteredStats()">
                            <option value="all">All Stages</option>
                            <option value="round_robin">Round Robin</option>
                            <option value="knockout">Knockout</option>
                        </select>
                    </div>
                </div>
                <div id="filteredStatsContent"></div>
            </div>
        </div>

        <!-- Head-to-Head Tab -->
        <div id="headToHead" class="tab-content">
            <div class="card">
                <h2>‚öîÔ∏è Head-to-Head Comparison</h2>
                <div class="grid-2">
                    <div>
                        <div class="form-group">
                            <label for="player1Select">Player 1</label>
                            <select id="player1Select" class="form-control">
                                <option value="">Select Player 1</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="player1Events">Player 1 Events Filter</label>
                            <select id="player1Events" class="form-control" multiple size="4">
                                <option value="all" selected>All Events</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="player2Select">Player 2</label>
                            <select id="player2Select" class="form-control">
                                <option value="">Select Player 2</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="player2Events">Player 2 Events Filter</label>
                            <select id="player2Events" class="form-control" multiple size="4">
                                <option value="all" selected>All Events</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="compareHeadToHead()">Compare Players</button>
                <div id="h2hContent"></div>
            </div>
        </div>

        <!-- Player Analysis Tab -->
        <div id="playerStats" class="tab-content">
            <div class="card">
                <h2>üë§ Individual Player Analysis</h2>
                <div class="form-group">
                    <label for="playerAnalysisSelect">Select Player</label>
                    <select id="playerAnalysisSelect" class="form-control" onchange="loadPlayerAnalysis()">
                        <option value="">Choose a player...</option>
                    </select>
                </div>
                <div id="playerAnalysisContent"></div>
            </div>
        </div>

        <!-- Current Form Tab -->
        <div id="form" class="tab-content">
            <div class="card">
                <h2>üìà Current Form Tracker</h2>
                <div class="filter-row">
                    <div class="form-group">
                        <label for="formPlayerSelect">Player</label>
                        <select id="formPlayerSelect" class="form-control" onchange="loadPlayerForm()">
                            <option value="">Select Player</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="formType">Form Type</label>
                        <select id="formType" class="form-control" onchange="loadPlayerForm()">
                            <option value="matches">Last X Matches</option>
                            <option value="legs">Last X Legs</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="formCount">Count</label>
                        <select id="formCount" class="form-control" onchange="loadPlayerForm()">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="15">15</option>
                            <option value="20">20</option>
                            <option value="25">25</option>
                            <option value="30">30</option>
                        </select>
                    </div>
                </div>
                <div id="formContent"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card" style="background: rgba(100, 149, 237, 0.1); border: 1px solid rgba(100, 149, 237, 0.3);">
                <h2 style="color: #6495ED;">‚öôÔ∏è Organization Settings & Customization</h2>
                <p style="margin-bottom: 15px; line-height: 1.6;">
                    Customize your stats display appearance, manage organization info, upload logos, and configure display settings.
                    Changes apply to your public display page: <strong><span id="settingsDisplayUrl">Loading...</span></strong>
                </p>
            </div>

            <!-- Organization Info Section -->
            <div class="card">
                <h2>üè¢ Organization Information</h2>
                <div class="form-group">
                    <label for="settingsOrgName">Organization Name *</label>
                    <input type="text" id="settingsOrgName" class="form-control" placeholder="Your Organization Name">
                </div>
                
                <div class="form-group">
                    <label for="settingsOrgLogo">Organization Logo</label>
                    <input type="file" id="settingsOrgLogo" accept="image/png,image/jpeg,image/svg+xml" class="form-control">
                    <small style="color: #888;">PNG, JPG, or SVG - Max 2MB</small>
                    <div id="orgLogoPreview" style="margin-top: 10px;"></div>
                </div>

                <button class="btn" onclick="saveOrganizationInfo()" style="background: #6495ED;">
                    üíæ Save Organization Info
                </button>
                <div id="orgInfoStatus" style="margin-top: 15px;"></div>
            </div>

            <!-- Series/Seasons Management -->
            <div class="card">
                <h2>üèÜ Series & Events Configuration</h2>
                
                <!-- Add Series Form -->
                <div style="background: rgba(100, 149, 237, 0.1); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">‚ûï Add New Series/Season</h3>
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="newSeriesName">Series Name</label>
                            <input type="text" id="newSeriesName" class="form-control" placeholder="e.g., Winter Series 2024">
                        </div>
                        <div class="form-group">
                            <label for="newSeriesNumEvents">Number of Events</label>
                            <input type="number" id="newSeriesNumEvents" class="form-control" min="1" value="5">
                        </div>
                    </div>
                    <div class="grid-2">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="newSeriesIsToc">
                            <span>üèÜ Tournament of Champions (TOC)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="newSeriesDisplay" checked>
                            <span>üëÅÔ∏è Display on Stats Page</span>
                        </label>
                    </div>
                    <button class="btn" onclick="addSeries()" style="background: #28a745; margin-top: 10px;">
                        ‚ûï Add Series
                    </button>
                </div>
                
                <!-- Series List -->
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">üìã Your Series/Seasons</h3>
                    <div id="seriesList" style="max-height: 400px; overflow-y: auto;">
                        <p style="color: #888; text-align: center; padding: 20px;">Loading series...</p>
                    </div>
                </div>
                
                <!-- Display Toggles -->
                <h3 style="margin-bottom: 10px;">Display Options</h3>
                <div class="grid-2">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowSeries" checked>
                        <span>üìä Show Series Events</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowStandalone" checked>
                        <span>üìå Show Standalone Events</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowToc" checked>
                        <span>üèÜ Show TOC Events</span>
                    </label>
                </div>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">Visible Statistics Sections</h3>
                <div class="grid-2">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowAverages" checked>
                        <span>üìä Player Averages</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowHighOut" checked>
                        <span>üéØ High Checkouts</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowTonPlus" checked>
                        <span>üíØ 100+ Scores</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowHighest" checked>
                        <span>üî• Highest Scores</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowChampions" checked>
                        <span>üèÜ Event Champions</span>
                    </label>
                </div>

                <button class="btn" onclick="saveDisplaySettings()" style="background: #6495ED; margin-top: 20px;">
                    üíæ Save Display Settings
                </button>
                <div id="displaySettingsStatus" style="margin-top: 15px;"></div>
            </div>

            <!-- Colors & Styling -->
            <div class="card">
                <h2>üé® Colors & Styling</h2>
                <div class="grid-3">
                    <div class="form-group">
                        <label for="settingsPrimaryColor">Primary Color</label>
                        <input type="color" id="settingsPrimaryColor" value="#00d4ff" class="form-control" style="height: 50px;">
                        <small style="color: #888;">Main accent color</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="settingsTextColor">Text Color</label>
                        <input type="color" id="settingsTextColor" value="#ffffff" class="form-control" style="height: 50px;">
                        <small style="color: #888;">Primary text</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="settingsBorderColor">Border Color</label>
                        <input type="color" id="settingsBorderColor" value="#00d4ff" class="form-control" style="height: 50px;">
                        <small style="color: #888;">Cards & borders</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="settingsBackgroundColor">Background Color</label>
                        <input type="color" id="settingsBackgroundColor" value="#1a1a1a" class="form-control" style="height: 50px;">
                        <small style="color: #888;">Page background</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="settingsHeaderBgColor">Header Background</label>
                        <input type="color" id="settingsHeaderBgColor" value="#000000" class="form-control" style="height: 50px;">
                        <small style="color: #888;">Header section</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="settingsSecondaryColor">Secondary Color</label>
                        <input type="color" id="settingsSecondaryColor" value="#ffffff" class="form-control" style="height: 50px;">
                        <small style="color: #888;">Secondary elements</small>
                    </div>
                </div>

                <button class="btn" onclick="saveColorSettings()" style="background: #6495ED; margin-top: 20px;">
                    üé® Save Color Settings
                </button>
                <div id="colorSettingsStatus" style="margin-top: 15px;"></div>
            </div>

            <!-- Sponsors & Partners -->
            <div class="card">
                <h2>ü§ù Sponsors & Partners</h2>
                <p style="margin-bottom: 15px; color: #888;">
                    Upload sponsor/partner logos that will appear on your display page with clickable links.
                </p>

                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="settingsShowSponsors" checked>
                        <span>Show Sponsors on Display</span>
                    </label>
                    <div class="form-group" style="flex: 1; max-width: 250px;">
                        <label for="settingsSponsorPosition">Sponsor Position</label>
                        <select id="settingsSponsorPosition" class="form-control">
                            <option value="bottom">Bottom of Page</option>
                            <option value="top">Top of Page</option>
                            <option value="sidebar">Sidebar</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="sponsorName">Sponsor Name</label>
                    <input type="text" id="sponsorName" class="form-control" placeholder="Sponsor Company">
                </div>

                <div class="form-group">
                    <label for="sponsorUrl">Sponsor Website URL</label>
                    <input type="url" id="sponsorUrl" class="form-control" placeholder="https://sponsor.com">
                    <small style="color: #888;">Optional - makes logo clickable</small>
                </div>

                <div class="form-group">
                    <label for="sponsorLogo">Sponsor Logo</label>
                    <input type="file" id="sponsorLogo" accept="image/png,image/jpeg,image/svg+xml" class="form-control">
                    <small style="color: #888;">PNG, JPG, or SVG - Max 2MB</small>
                </div>

                <button class="btn" onclick="addSponsor()" style="background: #28a745;">
                    ‚ûï Add Sponsor
                </button>
                <div id="sponsorStatus" style="margin-top: 15px;"></div>

                <h3 style="margin-top: 30px; margin-bottom: 15px;">Current Sponsors</h3>
                <div id="sponsorsList"></div>
            </div>

            <!-- Display URL Info -->
            <div class="card" style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3);">
                <h2>üì∫ Your Public Display Page</h2>
                <p style="margin-bottom: 15px; line-height: 1.6;">
                    Share this URL with your organization or embed it in OBS for live streaming:
                </p>
                <div class="form-group">
                    <input type="text" id="displayUrlInput" class="form-control" readonly style="font-family: monospace; background: rgba(0,0,0,0.3);">
                </div>
                <button class="btn" onclick="copyDisplayUrl()" style="background: #ffd700; color: #000;">
                    üìã Copy Display URL
                </button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration - v1.1.0-20251219-0311
        // Declare global variable
        var supabase;
        var API_BASE;
        
        (function() {
            const SUPABASE_URL = 'https://kswwbqumgsdissnwuiab.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtzd3dicXVtZ3NkaXNzbnd1aWFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0ODMwNTIsImV4cCI6MjA4MDA1OTA1Mn0.b-z8JqL1dBYJcrrzSt7u6VAaFAtTOl1vqqtFFgHkJ50';
            API_BASE = `${SUPABASE_URL}/functions/v1`;

            // Initialize Supabase client (prevent duplicate declarations from cached scripts)
            if (!window.aadsSupabaseClient) {
                window.aadsSupabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }
            supabase = window.aadsSupabaseClient;
        })();

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load data when tab is opened
            if (tabName === 'leaderboard') loadLeaderboard();
            if (tabName === 'achievements') loadAchievements();
            if (tabName === 'headToHead' || tabName === 'playerStats' || tabName === 'form') loadPlayersList();
        }

        // Load leaderboard
        async function loadLeaderboard() {
            const content = document.getElementById('leaderboardContent');
            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/aads-api/stats`);
                const data = await response.json();
                
                let html = '<table class="stats-table"><thead><tr>';
                html += '<th>Rank</th><th>Player</th><th>Average</th><th>Legs</th>';
                html += '<th>180s</th><th>140+</th><th>100+</th><th>High Finish</th><th>Events</th>';
                html += '</tr></thead><tbody>';
                
                data.players.forEach(player => {
                    const rankClass = player.rank <= 3 ? `rank-${player.rank}` : '';
                    html += `<tr>
                        <td><span class="rank-badge ${rankClass}">${player.rank}</span></td>
                        <td><strong>${player.name}</strong></td>
                        <td>${player.total_average.toFixed(2)}</td>
                        <td>${player.total_legs}</td>
                        <td>${player.total_180s}</td>
                        <td>${player.total_140_plus}</td>
                        <td>${player.total_100_plus}</td>
                        <td>${player.highest_finish}</td>
                        <td>${player.events_played}</td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error loading leaderboard: ${error.message}</div>`;
            }
        }

        // Scrape event
        async function scrapeEvent() {
            const url = document.getElementById('eventUrl').value;
            const eventNum = document.getElementById('eventNumber').value;
            const statusDiv = document.getElementById('eventStatus');
            
            if (!url || !eventNum) {
                statusDiv.innerHTML = '<div class="error-message">Please provide both URL and event number</div>';
                return;
            }
            
            // Get current user ID
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                statusDiv.innerHTML = '<div class="error-message">‚ùå Not authenticated</div>';
                return;
            }
            
            statusDiv.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Scraping event... This may take 1-2 minutes...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/scrape-event`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        event_url: url,
                        user_id: user.id  // Include user_id for multi-tenant
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const displayUrl = `stats-display.html?user=${user.id}`;
                    statusDiv.innerHTML = `
                        <div class="success-message">
                            <h3>‚úÖ Event Scraped Successfully!</h3>
                            <p>Total Matches: ${result.total_matches}</p>
                            <p>Successfully Scraped: ${result.successful_scrapes}</p>
                            <p>Failed: ${result.failed_scrapes}</p>
                            <p>Players Updated: ${result.players_updated.length}</p>
                            <hr style="margin: 15px 0; border: 1px solid rgba(0, 255, 0, 0.3);">
                            <p style="font-weight: bold;">üì∫ Stats are now live on your display!</p>
                            <a href="${displayUrl}" target="_blank" rel="noopener" 
                               style="display: inline-block; padding: 8px 16px; background: rgba(0, 255, 0, 0.2); 
                                      color: #0f0; text-decoration: none; border-radius: 5px; margin-top: 10px; 
                                      border: 1px solid rgba(0, 255, 0, 0.3);">
                                View Your Public Stats ‚Üí
                            </a>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `<div class="error-message">Error: ${result.error}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        // Load events list
        async function loadEventsList() {
            const content = document.getElementById('eventsListContent');
            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/aads-api/events`);
                const data = await response.json();
                
                if (data.events.length === 0) {
                    content.innerHTML = '<p>No events found yet.</p>';
                    return;
                }
                
                // Update delete event dropdown
                const deleteSelect = document.getElementById('deleteEventNumber');
                deleteSelect.innerHTML = '<option value="">-- Select an event --</option>';
                data.events.forEach(event => {
                    const option = document.createElement('option');
                    option.value = event.event_number;
                    option.textContent = `Event ${event.event_number} - ${event.event_date || 'TBD'} (${event.unique_players || 0} players)`;
                    deleteSelect.appendChild(option);
                });
                
                let html = '<table class="stats-table"><thead><tr>';
                html += '<th>Event</th><th>Date</th><th>Matches</th><th>Players</th><th>Winner</th>';
                html += '</tr></thead><tbody>';
                
                data.events.forEach(event => {
                    html += `<tr>
                        <td><strong>Event ${event.event_number}</strong></td>
                        <td>${event.event_date || 'TBD'}</td>
                        <td>${event.total_matches || 0}</td>
                        <td>${event.unique_players || 0}</td>
                        <td>${event.winner_name || 'TBD'}</td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        // Load players list for dropdowns
        async function loadPlayersList() {
            try {
                const response = await fetch(`${API_BASE}/aads-api/stats`);
                const data = await response.json();
                
                const selects = ['player1Select', 'player2Select', 'playerAnalysisSelect', 'formPlayerSelect'];
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        const currentValue = select.value;
                        select.innerHTML = '<option value="">Select Player</option>';
                        data.players.forEach(player => {
                            select.innerHTML += `<option value="${player.name}">${player.name}</option>`;
                        });
                        select.value = currentValue;
                    }
                });

                // Populate event filters
                const eventSelects = ['player1Events', 'player2Events'];
                eventSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.innerHTML = '<option value="all" selected>All Events</option>';
                        for (let i = 1; i <= 7; i++) {
                            select.innerHTML += `<option value="${i}">Event ${i}</option>`;
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading players:', error);
            }
        }

        // Load filtered stats
        async function loadFilteredStats() {
            const series = document.getElementById('filterSeries').value;
            const event = document.getElementById('filterEvent').value;
            const stage = document.getElementById('filterStage').value;
            const content = document.getElementById('filteredStatsContent');
            
            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading filtered stats...</div>';
            
            try {
                const { data, error } = await supabase
                    .from('player_performances')
                    .select(`
                        *,
                        events (event_number, event_date),
                        matches (match_stage)
                    `)
                    .order('average', { ascending: false });

                if (error) throw error;

                // Apply filters
                let filtered = data;
                if (event !== 'all') {
                    filtered = filtered.filter(p => p.events?.event_number == event);
                }
                if (stage !== 'all') {
                    filtered = filtered.filter(p => p.matches?.match_stage === stage);
                }

                // Aggregate by player
                const playerStats = {};
                filtered.forEach(perf => {
                    if (!playerStats[perf.player_name]) {
                        playerStats[perf.player_name] = {
                            totalLegs: 0,
                            totalScore: 0,
                            highFinish: 0,
                            total180s: 0,
                            total140plus: 0,
                            total100plus: 0
                        };
                    }
                    const stats = playerStats[perf.player_name];
                    stats.totalLegs += perf.legs_played;
                    stats.totalScore += perf.average * perf.legs_played;
                    stats.highFinish = Math.max(stats.highFinish, perf.highest_finish);
                    stats.total180s += perf.total_180s;
                    stats.total140plus += perf.total_140_plus;
                    stats.total100plus += perf.total_100_plus;
                });

                // Calculate averages
                Object.keys(playerStats).forEach(name => {
                    const stats = playerStats[name];
                    stats.average = stats.totalLegs > 0 ? (stats.totalScore / stats.totalLegs).toFixed(2) : 0;
                });

                // Display
                let html = '<table class="stats-table"><thead><tr>';
                html += '<th>Player</th><th>Average</th><th>Legs</th><th>180s</th><th>140+</th><th>100+</th><th>High Finish</th>';
                html += '</tr></thead><tbody>';
                
                Object.entries(playerStats)
                    .sort((a, b) => b[1].average - a[1].average)
                    .forEach(([name, stats]) => {
                        html += `<tr>
                            <td><strong>${name}</strong></td>
                            <td>${stats.average}</td>
                            <td>${stats.totalLegs}</td>
                            <td>${stats.total180s}</td>
                            <td>${stats.total140plus}</td>
                            <td>${stats.total100plus}</td>
                            <td>${stats.highFinish}</td>
                        </tr>`;
                    });
                
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        // Compare head-to-head
        async function compareHeadToHead() {
            const player1 = document.getElementById('player1Select').value;
            const player2 = document.getElementById('player2Select').value;
            const content = document.getElementById('h2hContent');

            if (!player1 || !player2) {
                content.innerHTML = '<div class="error-message">Please select both players</div>';
                return;
            }

            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Comparing players...</div>';

            try {
                const { data, error } = await supabase
                    .from('player_performances')
                    .select('*')
                    .in('player_name', [player1, player2]);

                if (error) throw error;

                const p1Data = data.filter(d => d.player_name === player1);
                const p2Data = data.filter(d => d.player_name === player2);

                const p1Stats = calculateStats(p1Data);
                const p2Stats = calculateStats(p2Data);

                let html = '<div class="vs-container">';
                html += `<div class="player-card">
                    <h3>${player1}</h3>
                    <div class="grid-3">
                        <div class="stat-card">
                            <span class="value">${p1Stats.average}</span>
                            <span class="label">Average</span>
                        </div>
                        <div class="stat-card">
                            <span class="value">${p1Stats.legs}</span>
                            <span class="label">Legs</span>
                        </div>
                        <div class="stat-card">
                            <span class="value">${p1Stats.highFinish}</span>
                            <span class="label">High Finish</span>
                        </div>
                    </div>
                </div>`;
                html += '<div class="vs-divider">VS</div>';
                html += `<div class="player-card">
                    <h3>${player2}</h3>
                    <div class="grid-3">
                        <div class="stat-card">
                            <span class="value">${p2Stats.average}</span>
                            <span class="label">Average</span>
                        </div>
                        <div class="stat-card">
                            <span class="value">${p2Stats.legs}</span>
                            <span class="label">Legs</span>
                        </div>
                        <div class="stat-card">
                            <span class="value">${p2Stats.highFinish}</span>
                            <span class="label">High Finish</span>
                        </div>
                    </div>
                </div></div>`;

                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        // Load player analysis
        async function loadPlayerAnalysis() {
            const player = document.getElementById('playerAnalysisSelect').value;
            const content = document.getElementById('playerAnalysisContent');

            if (!player) {
                content.innerHTML = '';
                return;
            }

            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading analysis...</div>';

            try {
                const { data, error } = await supabase
                    .from('player_performances')
                    .select(`
                        *,
                        events (event_number, event_date),
                        matches (match_stage)
                    `)
                    .eq('player_name', player)
                    .order('created_at', { ascending: true });

                if (error) throw error;

                const overallStats = calculateStats(data);
                const roundRobinData = data.filter(d => d.matches?.match_stage === 'round_robin');
                const knockoutData = data.filter(d => d.matches?.match_stage === 'knockout');

                let html = '<div class="grid-3">';
                html += `
                    <div class="stat-card">
                        <span class="value">${overallStats.average}</span>
                        <span class="label">Overall Average</span>
                    </div>
                    <div class="stat-card">
                        <span class="value">${overallStats.legs}</span>
                        <span class="label">Total Legs</span>
                    </div>
                    <div class="stat-card">
                        <span class="value">${overallStats.highFinish}</span>
                        <span class="label">High Finish</span>
                    </div>
                `;
                html += '</div>';

                html += '<h3 style="margin-top: 30px; color: #ffd700;">By Stage</h3>';
                html += '<div class="grid-2">';
                html += `
                    <div class="stat-card">
                        <strong>Round Robin</strong>
                        <div style="margin-top: 10px;">
                            Avg: ${calculateStats(roundRobinData).average}<br>
                            Legs: ${calculateStats(roundRobinData).legs}
                        </div>
                    </div>
                    <div class="stat-card">
                        <strong>Knockout</strong>
                        <div style="margin-top: 10px;">
                            Avg: ${calculateStats(knockoutData).average}<br>
                            Legs: ${calculateStats(knockoutData).legs}
                        </div>
                    </div>
                `;
                html += '</div>';

                html += '<h3 style="margin-top: 30px; color: #ffd700;">Event Breakdown</h3>';
                html += '<table class="stats-table"><thead><tr>';
                html += '<th>Event</th><th>Average</th><th>Legs</th><th>High Finish</th>';
                html += '</tr></thead><tbody>';

                const byEvent = {};
                data.forEach(perf => {
                    const eventNum = perf.events?.event_number || 'Unknown';
                    if (!byEvent[eventNum]) byEvent[eventNum] = [];
                    byEvent[eventNum].push(perf);
                });

                Object.entries(byEvent).forEach(([event, perfs]) => {
                    const stats = calculateStats(perfs);
                    html += `<tr>
                        <td>Event ${event}</td>
                        <td>${stats.average}</td>
                        <td>${stats.legs}</td>
                        <td>${stats.highFinish}</td>
                    </tr>`;
                });

                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        // Load player form
        async function loadPlayerForm() {
            const player = document.getElementById('formPlayerSelect').value;
            const type = document.getElementById('formType').value;
            const count = parseInt(document.getElementById('formCount').value);
            const content = document.getElementById('formContent');

            if (!player) {
                content.innerHTML = '';
                return;
            }

            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading form...</div>';

            try {
                const { data, error } = await supabase
                    .from('player_performances')
                    .select('*')
                    .eq('player_name', player)
                    .order('created_at', { ascending: false })
                    .limit(type === 'matches' ? count : 100);

                if (error) throw error;

                let formData = data;
                if (type === 'legs') {
                    let totalLegs = 0;
                    formData = [];
                    for (const perf of data) {
                        if (totalLegs >= count) break;
                        formData.push(perf);
                        totalLegs += perf.legs_played;
                    }
                }

                const stats = calculateStats(formData);

                let html = '<div class="grid-3">';
                html += `
                    <div class="stat-card">
                        <span class="value">${stats.average}</span>
                        <span class="label">Recent Average</span>
                    </div>
                    <div class="stat-card">
                        <span class="value">${stats.legs}</span>
                        <span class="label">Legs Played</span>
                    </div>
                    <div class="stat-card">
                        <span class="value">${formData.length}</span>
                        <span class="label">Matches</span>
                    </div>
                `;
                html += '</div>';

                html += '<h3 style="margin-top: 20px; color: #ffd700;">Recent Performances</h3>';
                html += '<table class="stats-table"><thead><tr>';
                html += '<th>Match</th><th>Average</th><th>Legs</th><th>High Finish</th>';
                html += '</tr></thead><tbody>';

                formData.forEach((perf, idx) => {
                    html += `<tr>
                        <td>Match ${idx + 1}</td>
                        <td>${perf.average.toFixed(2)}</td>
                        <td>${perf.legs_played}</td>
                        <td>${perf.highest_finish}</td>
                    </tr>`;
                });

                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        // Helper function to calculate stats
        function calculateStats(data) {
            if (!data || data.length === 0) {
                return { average: '0.00', legs: 0, highFinish: 0 };
            }

            let totalLegs = 0;
            let totalScore = 0;
            let highFinish = 0;

            data.forEach(perf => {
                totalLegs += perf.legs_played || 0;
                totalScore += (perf.average || 0) * (perf.legs_played || 0);
                highFinish = Math.max(highFinish, perf.highest_finish || 0);
            });

            const average = totalLegs > 0 ? (totalScore / totalLegs).toFixed(2) : '0.00';

            return { average, legs: totalLegs, highFinish };
        }

        // Load Event Details
        async function loadEventDetails() {
            const eventNum = document.getElementById('eventDetailsSelect').value;
            const content = document.getElementById('eventDetailsContent');

            if (!eventNum) {
                content.innerHTML = '';
                return;
            }

            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading event details...</div>';

            try {
                // Get event info
                const { data: eventData, error: eventError } = await supabase
                    .from('events')
                    .select('*')
                    .eq('event_number', eventNum)
                    .single();

                if (eventError) throw eventError;

                // Get all matches for this event
                const { data: matches, error: matchesError } = await supabase
                    .from('matches')
                    .select('*, player_performances(*)')
                    .eq('event_id', eventData.id)
                    .order('match_number');

                if (matchesError) throw matchesError;

                // Get event winner
                const { data: winnerData } = await supabase
                    .from('event_winners')
                    .select('*')
                    .eq('event_id', eventData.id)
                    .single();

                let html = '';

                // Champion Banner
                if (winnerData) {
                    html += `
                        <div class="champion-banner">
                            <div class="trophy">üèÜ</div>
                            <div>Event ${eventNum} Champion: ${winnerData.winner_name}</div>
                            ${winnerData.runner_up_name ? `<div style="font-size: 0.8em; margin-top: 5px;">Runner-up: ${winnerData.runner_up_name}</div>` : ''}
                        </div>
                    `;
                }

                // Round Robin Standings
                const roundRobinMatches = matches.filter(m => m.match_stage === 'round_robin');
                if (roundRobinMatches.length > 0) {
                    html += '<h3 style="color: #ffd700; margin-top: 20px;">üìä Round Robin Standings</h3>';
                    
                    // Calculate standings
                    const standings = {};
                    roundRobinMatches.forEach(match => {
                        match.player_performances.forEach(perf => {
                            if (!standings[perf.player_name]) {
                                standings[perf.player_name] = {
                                    matches: 0,
                                    wins: 0,
                                    legs_won: 0,
                                    legs_lost: 0,
                                    average: 0,
                                    totalScore: 0,
                                    totalLegs: 0
                                };
                            }
                            const s = standings[perf.player_name];
                            s.matches++;
                            s.legs_won += perf.legs_won || 0;
                            s.totalScore += perf.average * perf.legs_played;
                            s.totalLegs += perf.legs_played;
                        });
                    });

                    // Calculate averages and sort
                    const standingsArray = Object.entries(standings).map(([name, stats]) => {
                        stats.average = (stats.totalScore / stats.totalLegs).toFixed(2);
                        stats.name = name;
                        return stats;
                    }).sort((a, b) => b.legs_won - a.legs_won || b.average - a.average);

                    html += '<table class="stats-table"><thead><tr>';
                    html += '<th>Position</th><th>Player</th><th>Matches</th><th>Legs Won</th><th>Average</th>';
                    html += '</tr></thead><tbody>';
                    
                    standingsArray.forEach((player, idx) => {
                        html += `<tr>
                            <td><span class="rank-badge ${idx < 3 ? 'rank-' + (idx + 1) : ''}">${idx + 1}</span></td>
                            <td><strong>${player.name}</strong></td>
                            <td>${player.matches}</td>
                            <td>${player.legs_won}</td>
                            <td>${player.average}</td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                }

                // Knockout Bracket
                const knockoutMatches = matches.filter(m => m.match_stage === 'knockout');
                if (knockoutMatches.length > 0) {
                    html += '<h3 style="color: #ffd700; margin-top: 30px;">üèÜ Knockout Bracket</h3>';
                    
                    // Group by round
                    const rounds = {
                        'Quarter Finals': [],
                        'Semi Finals': [],
                        'Final': []
                    };

                    knockoutMatches.forEach(match => {
                        const roundName = match.round_name || 'Unknown';
                        if (roundName.includes('Quarter')) rounds['Quarter Finals'].push(match);
                        else if (roundName.includes('Semi')) rounds['Semi Finals'].push(match);
                        else if (roundName.includes('Final')) rounds['Final'].push(match);
                    });

                    html += '<div class="bracket-container">';
                    
                    ['Quarter Finals', 'Semi Finals', 'Final'].forEach(roundName => {
                        if (rounds[roundName].length > 0) {
                            html += `<div class="bracket-round">
                                <h3>${roundName}</h3>`;
                            
                            rounds[roundName].forEach(match => {
                                html += '<div class="bracket-match">';
                                
                                // Get players from performances
                                const players = match.player_performances;
                                if (players && players.length >= 2) {
                                    const p1 = players[0];
                                    const p2 = players[1];
                                    const p1Win = (p1.legs_won || 0) > (p2.legs_won || 0);
                                    const p2Win = (p2.legs_won || 0) > (p1.legs_won || 0);
                                    
                                    html += `
                                        <div class="bracket-player ${p1Win ? 'winner' : ''}">
                                            <span>${p1.player_name}</span>
                                            <span class="score">${p1.legs_won || 0}</span>
                                        </div>
                                        <div class="bracket-player ${p2Win ? 'winner' : ''}">
                                            <span>${p2.player_name}</span>
                                            <span class="score">${p2.legs_won || 0}</span>
                                        </div>
                                    `;
                                }
                                html += '</div>';
                            });
                            
                            html += '</div>';
                        }
                    });
                    
                    html += '</div>';
                }

                // Match Results
                html += '<h3 style="color: #ffd700; margin-top: 30px;">üìã All Match Results</h3>';
                html += '<table class="stats-table"><thead><tr>';
                html += '<th>Stage</th><th>Player 1</th><th>Score</th><th>Player 2</th><th>Avg</th>';
                html += '</tr></thead><tbody>';
                
                matches.forEach(match => {
                    if (match.player_performances && match.player_performances.length >= 2) {
                        const p1 = match.player_performances[0];
                        const p2 = match.player_performances[1];
                        html += `<tr>
                            <td>${match.match_stage}</td>
                            <td><strong>${p1.player_name}</strong></td>
                            <td style="text-align: center; color: #ffd700; font-weight: bold;">
                                ${p1.legs_won || 0} - ${p2.legs_won || 0}
                            </td>
                            <td><strong>${p2.player_name}</strong></td>
                            <td>${p1.average.toFixed(2)} / ${p2.average.toFixed(2)}</td>
                        </tr>`;
                    }
                });
                html += '</tbody></table>';

                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error loading event details: ${error.message}</div>`;
            }
        }

        // Load Achievements
        async function loadAchievements() {
            const content = document.getElementById('achievementsContent');
            content.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading...</div>';

            try {
                // Get all events and winners
                const { data: events, error: eventsError } = await supabase
                    .from('events')
                    .select('*, event_winners(*)');

                if (eventsError) throw eventsError;

                // Get all player performances to calculate positions
                const { data: allPerformances, error: perfError } = await supabase
                    .from('player_performances')
                    .select('*');

                if (perfError) throw perfError;

                // Track player achievements
                const playerAchievements = {};

                // Count championship wins and runner-ups from event_winners
                events.forEach(event => {
                    if (event.event_winners && event.event_winners.length > 0) {
                        const winner = event.event_winners[0];
                        
                        if (winner.winner_name) {
                            if (!playerAchievements[winner.winner_name]) {
                                playerAchievements[winner.winner_name] = {
                                    champions: 0,
                                    runnerUp: 0,
                                    joint3rd: 0,
                                    joint5th: 0,
                                    joint9th: 0,
                                    bestPosition: '1st'
                                };
                            }
                            playerAchievements[winner.winner_name].champions++;
                        }

                        if (winner.runner_up_name) {
                            if (!playerAchievements[winner.runner_up_name]) {
                                playerAchievements[winner.runner_up_name] = {
                                    champions: 0,
                                    runnerUp: 0,
                                    joint3rd: 0,
                                    joint5th: 0,
                                    joint9th: 0,
                                    bestPosition: '2nd'
                                };
                            }
                            playerAchievements[winner.runner_up_name].runnerUp++;
                            if (playerAchievements[winner.runner_up_name].bestPosition === 'Unknown') {
                                playerAchievements[winner.runner_up_name].bestPosition = '2nd';
                            }
                        }
                    }
                });

                // Initialize all players
                const allPlayers = [...new Set(allPerformances.map(p => p.player_name))];
                allPlayers.forEach(player => {
                    if (!playerAchievements[player]) {
                        playerAchievements[player] = {
                            champions: 0,
                            runnerUp: 0,
                            joint3rd: 0,
                            joint5th: 0,
                            joint9th: 0,
                            bestPosition: 'Participated'
                        };
                    }
                });

                let html = '<div class="card"><h2>üèÜ Champions</h2>';
                const champions = Object.entries(playerAchievements)
                    .filter(([_, stats]) => stats.champions > 0)
                    .sort((a, b) => b[1].champions - a[1].champions);

                if (champions.length > 0) {
                    html += '<table class="stats-table"><thead><tr>';
                    html += '<th>Player</th><th>Championships</th><th>Runner-Up</th><th>Best Position</th>';
                    html += '</tr></thead><tbody>';
                    
                    champions.forEach(([player, stats]) => {
                        html += `<tr>
                            <td><strong>${player}</strong></td>
                            <td><span class="position-badge pos-champion">${stats.champions}x Champion</span></td>
                            <td>${stats.runnerUp > 0 ? `<span class="position-badge pos-runner-up">${stats.runnerUp}x Runner-up</span>` : '-'}</td>
                            <td><span class="position-badge pos-champion">${stats.bestPosition}</span></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                } else {
                    html += '<p>No champions recorded yet.</p>';
                }
                html += '</div>';

                html += '<div class="card"><h2>üìä All Player Best Positions</h2>';
                html += '<table class="stats-table"><thead><tr>';
                html += '<th>Rank</th><th>Player</th><th>Best Position</th><th>Championships</th><th>Runner-Up Finishes</th>';
                html += '</tr></thead><tbody>';

                const sortedPlayers = Object.entries(playerAchievements)
                    .sort((a, b) => {
                        const posOrder = { '1st': 1, '2nd': 2, 'Joint 3rd': 3, 'Joint 5th': 5, 'Joint 9th': 9, 'Participated': 99 };
                        const aPos = posOrder[a[1].bestPosition] || 99;
                        const bPos = posOrder[b[1].bestPosition] || 99;
                        if (aPos !== bPos) return aPos - bPos;
                        return b[1].champions - a[1].champions;
                    });

                sortedPlayers.forEach(([player, stats], idx) => {
                    let posClass = 'pos-9th';
                    if (stats.bestPosition === '1st') posClass = 'pos-champion';
                    else if (stats.bestPosition === '2nd') posClass = 'pos-runner-up';
                    else if (stats.bestPosition === 'Joint 3rd') posClass = 'pos-3rd';
                    else if (stats.bestPosition === 'Joint 5th') posClass = 'pos-5th';

                    html += `<tr>
                        <td>${idx + 1}</td>
                        <td><strong>${player}</strong></td>
                        <td><span class="position-badge ${posClass}">${stats.bestPosition}</span></td>
                        <td>${stats.champions > 0 ? `<span class="position-badge pos-champion">${stats.champions}x</span>` : '-'}</td>
                        <td>${stats.runnerUp > 0 ? `<span class="position-badge pos-runner-up">${stats.runnerUp}x</span>` : '-'}</td>
                    </tr>`;
                });

                html += '</tbody></table></div>';
                content.innerHTML = html;
            } catch (error) {
                content.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
            }
        }

        // Copy to clipboard function
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999); // For mobile devices
            
            // Try the modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(element.value).then(() => {
                    alert('‚úÖ Copied to clipboard!');
                }).catch(() => {
                    // Fallback to older method
                    document.execCommand('copy');
                    alert('‚úÖ Copied to clipboard!');
                });
            } else {
                // Fallback for older browsers
                document.execCommand('copy');
                alert('‚úÖ Copied to clipboard!');
            }
        }

        // Confirm and delete event
        async function confirmDeleteEvent() {
            const eventNumber = document.getElementById('deleteEventNumber').value;
            const statusDiv = document.getElementById('deleteEventStatus');
            
            if (!eventNumber) {
                statusDiv.innerHTML = '<p style="color: #ff4444;">‚ö†Ô∏è Please select an event to delete</p>';
                return;
            }
            
            // Confirmation dialog
            const confirmed = confirm(
                `‚ö†Ô∏è WARNING: Delete Event ${eventNumber}?\n\n` +
                `This will permanently remove:\n` +
                `‚Ä¢ Event details\n` +
                `‚Ä¢ All matches from this event\n` +
                `‚Ä¢ All player performances\n` +
                `‚Ä¢ All statistics\n\n` +
                `This action CANNOT be undone!\n\n` +
                `Are you absolutely sure?`
            );
            
            if (!confirmed) {
                statusDiv.innerHTML = '<p style="color: #888;">Deletion cancelled</p>';
                return;
            }
            
            statusDiv.innerHTML = '<p style="color: #ffaa00;">üóëÔ∏è Deleting event...</p>';
            
            try {
                // Delete from events table (cascade should handle related data)
                const { error } = await supabase
                    .from('events')
                    .delete()
                    .eq('event_number', eventNumber);
                
                if (error) {
                    // Check if it's a permission error
                    if (error.code === '42501' || error.message.includes('permission') || error.message.includes('policy')) {
                        throw new Error(
                            'Permission denied. You need to enable DELETE policies in Supabase.\n\n' +
                            'Go to Supabase Dashboard ‚Üí Authentication ‚Üí Policies ‚Üí events table ‚Üí Create DELETE policy\n\n' +
                            'See the instructions above for detailed setup steps.'
                        );
                    }
                    throw error;
                }
                
                statusDiv.innerHTML = `<p style="color: #00ff88;">‚úÖ Event ${eventNumber} deleted successfully!</p>`;
                
                // Refresh the events list
                setTimeout(() => {
                    loadEventsList();
                    document.getElementById('deleteEventNumber').value = '';
                }, 1500);
                
            } catch (error) {
                console.error('Delete error:', error);
                const errorMsg = error.message || 'Unknown error occurred';
                statusDiv.innerHTML = `
                    <div style="background: rgba(255, 69, 0, 0.1); border: 1px solid rgba(255, 69, 0, 0.3); padding: 15px; border-radius: 5px;">
                        <p style="color: #ff4444; margin-bottom: 10px;">‚ùå <strong>Delete Failed</strong></p>
                        <p style="color: #ffaa00; line-height: 1.6; margin-bottom: 10px;">${errorMsg}</p>
                        <p style="color: #888; font-size: 0.9em;">
                            If you see a permission error, follow the setup instructions above to enable delete policies in Supabase.
                        </p>
                    </div>
                `;
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
        });

        // Check authentication status
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            
            if (user) {
                // User is logged in
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('adminInterface').style.display = 'block';
                document.getElementById('userEmail').textContent = user.email;
                
                // Load organization settings
                await loadOrganizationSettings();
                
                loadLeaderboard();
                // Display version in console
                console.log('%cüéØ DartStream Stats Platform v1.1.0-20251219-0200', 'color: #FF6B00; font-size: 16px; font-weight: bold;');
                console.log('%cUpdated: December 19, 2025 02:00', 'color: #888; font-size: 12px;');
                console.log('%cLogged in as: ' + user.email, 'color: #00ff88; font-size: 12px;');
            } else {
                // User is not logged in
                document.getElementById('authScreen').style.display = 'block';
                document.getElementById('adminInterface').style.display = 'none';
            }
        }

        // Handle login
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const statusDiv = document.getElementById('loginStatus');
            
            if (!email || !password) {
                statusDiv.innerHTML = '<p style="color: #ff4444;">‚ö†Ô∏è Please enter email and password</p>';
                return;
            }
            
            statusDiv.innerHTML = '<p style="color: #ffaa00;">üîÑ Signing in...</p>';
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                statusDiv.innerHTML = '<p style="color: #00ff88;">‚úÖ Login successful! Loading...</p>';
                
                // Reload to show admin interface
                setTimeout(() => {
                    checkAuth();
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMsg = error.message;
                
                if (error.message.includes('Invalid login credentials')) {
                    errorMsg = 'Invalid email or password. Please check your credentials.';
                } else if (error.message.includes('Email not confirmed')) {
                    errorMsg = 'Please confirm your email address before logging in.';
                }
                
                statusDiv.innerHTML = `
                    <div style="background: rgba(255, 69, 0, 0.1); border: 1px solid rgba(255, 69, 0, 0.3); padding: 15px; border-radius: 5px;">
                        <p style="color: #ff4444; margin-bottom: 10px;">‚ùå <strong>Login Failed</strong></p>
                        <p style="color: #ffaa00; line-height: 1.6;">${errorMsg}</p>
                    </div>
                `;
            }
        }

        // Handle logout
        async function handleLogout() {
            const confirmed = confirm('Are you sure you want to logout?');
            if (!confirmed) return;
            
            await supabase.auth.signOut();
            document.getElementById('authScreen').style.display = 'block';
            document.getElementById('adminInterface').style.display = 'none';
            document.getElementById('loginPassword').value = '';
        }

        // Show auth form (login or signup)
        function showAuthForm(formType) {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const loginBtn = document.getElementById('showLoginBtn');
            const signupBtn = document.getElementById('showSignupBtn');
            
            if (formType === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                loginBtn.style.background = '#ffd700';
                loginBtn.style.color = '#000';
                signupBtn.style.background = 'transparent';
                signupBtn.style.color = '#ffd700';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                signupBtn.style.background = '#ffd700';
                signupBtn.style.color = '#000';
                loginBtn.style.background = 'transparent';
                loginBtn.style.color = '#ffd700';
            }
        }

        // Handle signup
        async function handleSignup() {
            const orgName = document.getElementById('signupOrgName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            const statusDiv = document.getElementById('signupStatus');
            
            // Validation
            if (!orgName || !email || !password || !passwordConfirm) {
                statusDiv.innerHTML = '<p style="color: #ff4444;">‚ö†Ô∏è Please fill in all fields</p>';
                return;
            }
            
            if (password !== passwordConfirm) {
                statusDiv.innerHTML = '<p style="color: #ff4444;">‚ö†Ô∏è Passwords do not match</p>';
                return;
            }
            
            if (password.length < 6) {
                statusDiv.innerHTML = '<p style="color: #ff4444;">‚ö†Ô∏è Password must be at least 6 characters</p>';
                return;
            }
            
            statusDiv.innerHTML = '<p style="color: #ffaa00;">üîÑ Creating your account...</p>';
            
            try {
                // Create auth user
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (authError) throw authError;
                
                if (!authData.user) {
                    throw new Error('Account creation failed - no user returned');
                }
                
                // Create organization record
                const { error: orgError } = await supabase
                    .from('organizations')
                    .insert([{
                        user_id: authData.user.id,
                        organization_name: orgName
                    }]);
                
                if (orgError) {
                    console.error('Organization creation error:', orgError);
                    // Don't throw - user is created, they can set org name later
                }
                
                // Create default display settings
                const { error: settingsError } = await supabase
                    .from('display_settings')
                    .insert([{
                        user_id: authData.user.id,
                        series_count: 3,
                        singles_count: 5,
                        visible_stats: {
                            averages: true,
                            high_out: true,
                            ton_plus: true,
                            highest_score: true,
                            champions: true
                        },
                        primary_color: '#00d4ff',
                        text_color: '#ffffff',
                        border_color: '#00d4ff',
                        background_color: '#1a1a1a',
                        header_bg_color: '#000000',
                        secondary_color: '#ffffff'
                    }]);
                
                if (settingsError) {
                    console.error('Settings creation error:', settingsError);
                }
                
                statusDiv.innerHTML = '<p style="color: #00ff88;">‚úÖ Account created! Logging you in...</p>';
                
                // Auto-login
                setTimeout(async () => {
                    await checkAuth();
                }, 1500);
                
            } catch (error) {
                console.error('Signup error:', error);
                let errorMsg = error.message;
                
                if (error.message.includes('User already registered')) {
                    errorMsg = 'This email is already registered. Please login instead.';
                }
                
                statusDiv.innerHTML = `
                    <div style="background: rgba(255, 69, 0, 0.1); border: 1px solid rgba(255, 69, 0, 0.3); padding: 15px; border-radius: 5px;">
                        <p style="color: #ff4444; margin-bottom: 10px;">‚ùå <strong>Signup Failed</strong></p>
                        <p style="color: #ffaa00; line-height: 1.6;">${errorMsg}</p>
                    </div>
                `;
            }
        }

        // Load organization settings
        async function loadOrganizationSettings() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            try {
                // Get organization info
                const { data: orgData } = await supabase
                    .from('organizations')
                    .select('*')
                    .eq('user_id', user.id)
                    .single();
                
                if (orgData) {
                    document.getElementById('orgName').textContent = orgData.organization_name || 'DartStream';
                    document.getElementById('settingsOrgName').value = orgData.organization_name || '';
                    
                    if (orgData.logo_url) {
                        document.getElementById('orgLogoPreview').innerHTML = 
                            `<img src="${orgData.logo_url}" style="max-width: 200px; max-height: 100px; border: 1px solid #333; border-radius: 5px;">`;
                    }
                }
                
                // Get display settings
                const { data: settingsData } = await supabase
                    .from('display_settings')
                    .select('*')
                    .eq('user_id', user.id)
                    .single();
                
                if (settingsData) {
                    // Load display toggles
                    document.getElementById('settingsShowSeries').checked = settingsData.show_series !== false;
                    document.getElementById('settingsShowStandalone').checked = settingsData.show_standalone_events !== false;
                    document.getElementById('settingsShowToc').checked = settingsData.show_toc_events !== false;
                    
                    // Load visible stats checkboxes
                    const visibleStats = settingsData.visible_stats || {};
                    document.getElementById('settingsShowAverages').checked = visibleStats.averages !== false;
                    document.getElementById('settingsShowHighOut').checked = visibleStats.high_out !== false;
                    document.getElementById('settingsShowTonPlus').checked = visibleStats.ton_plus !== false;
                    document.getElementById('settingsShowHighest').checked = visibleStats.highest_score !== false;
                    document.getElementById('settingsShowChampions').checked = visibleStats.champions !== false;
                    
                    // Load colors
                    document.getElementById('settingsPrimaryColor').value = settingsData.primary_color || '#00d4ff';
                    document.getElementById('settingsTextColor').value = settingsData.text_color || '#ffffff';
                    document.getElementById('settingsBorderColor').value = settingsData.border_color || '#00d4ff';
                    document.getElementById('settingsBackgroundColor').value = settingsData.background_color || '#1a1a1a';
                    document.getElementById('settingsHeaderBgColor').value = settingsData.header_bg_color || '#000000';
                    document.getElementById('settingsSecondaryColor').value = settingsData.secondary_color || '#ffffff';
                    
                    // Load sponsor settings
                    document.getElementById('settingsShowSponsors').checked = settingsData.show_sponsors !== false;
                    document.getElementById('settingsSponsorPosition').value = settingsData.sponsor_position || 'bottom';
                }
                
                // Set display URL
                const displayUrl = `${window.location.origin}/aadsstatsscrapper/stats-display.html?user=${user.id}`;
                document.getElementById('displayUrlInput').value = displayUrl;
                document.getElementById('settingsDisplayUrl').innerHTML = 
                    `<a href="${displayUrl}" target="_blank" style="color: #6495ED;">${displayUrl}</a>`;
                
                // Load sponsors
                await loadSponsors();
                
                // Load series
                await loadSeries();
                
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Save organization info
        async function saveOrganizationInfo() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            const orgName = document.getElementById('settingsOrgName').value;
            const statusDiv = document.getElementById('orgInfoStatus');
            
            if (!orgName) {
                statusDiv.innerHTML = '<p style="color: #ff4444;">‚ö†Ô∏è Organization name is required</p>';
                return;
            }
            
            statusDiv.innerHTML = '<p style="color: #ffaa00;">üíæ Saving...</p>';
            
            try {
                // Handle logo upload if file selected
                let logoUrl = null;
                const logoFile = document.getElementById('settingsOrgLogo').files[0];
                
                if (logoFile) {
                    const fileExt = logoFile.name.split('.').pop();
                    const fileName = `${user.id}/org-logo.${fileExt}`;
                    
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('organization-logos')
                        .upload(fileName, logoFile, { upsert: true });
                    
                    if (uploadError) throw uploadError;
                    
                    const { data: urlData } = supabase.storage
                        .from('organization-logos')
                        .getPublicUrl(fileName);
                    
                    logoUrl = urlData.publicUrl;
                }
                
                // Upsert organization
                const { error } = await supabase
                    .from('organizations')
                    .upsert([{
                        user_id: user.id,
                        organization_name: orgName,
                        ...(logoUrl && { logo_url: logoUrl })
                    }]);
                
                if (error) throw error;
                
                statusDiv.innerHTML = '<p style="color: #00ff88;">‚úÖ Saved successfully!</p>';
                
                // Reload settings
                setTimeout(() => {
                    loadOrganizationSettings();
                }, 1500);
                
            } catch (error) {
                console.error('Save error:', error);
                statusDiv.innerHTML = `<p style="color: #ff4444;">‚ùå Error: ${error.message}</p>`;
            }
        }

        // Save display settings
        async function saveDisplaySettings() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            const statusDiv = document.getElementById('displaySettingsStatus');
            statusDiv.innerHTML = '<p style="color: #ffaa00;">üíæ Saving...</p>';
            
            try {
                const { error } = await supabase
                    .from('display_settings')
                    .upsert([{
                        user_id: user.id,
                        show_series: document.getElementById('settingsShowSeries').checked,
                        show_standalone_events: document.getElementById('settingsShowStandalone').checked,
                        show_toc_events: document.getElementById('settingsShowToc').checked,
                        visible_stats: {
                            averages: document.getElementById('settingsShowAverages').checked,
                            high_out: document.getElementById('settingsShowHighOut').checked,
                            ton_plus: document.getElementById('settingsShowTonPlus').checked,
                            highest_score: document.getElementById('settingsShowHighest').checked,
                            champions: document.getElementById('settingsShowChampions').checked
                        },
                        show_sponsors: document.getElementById('settingsShowSponsors').checked,
                        sponsor_position: document.getElementById('settingsSponsorPosition').value
                    }]);
                
                if (error) throw error;
                
                statusDiv.innerHTML = '<p style="color: #00ff88;">‚úÖ Display settings saved!</p>';
                
            } catch (error) {
                console.error('Save error:', error);
                statusDiv.innerHTML = `<p style="color: #ff4444;">‚ùå Error: ${error.message}</p>`;
            }
        }

        // Save color settings
        async function saveColorSettings() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            const statusDiv = document.getElementById('colorSettingsStatus');
            statusDiv.innerHTML = '<p style="color: #ffaa00;">üé® Saving...</p>';
            
            try {
                const { error } = await supabase
                    .from('display_settings')
                    .upsert([{
                        user_id: user.id,
                        primary_color: document.getElementById('settingsPrimaryColor').value,
                        text_color: document.getElementById('settingsTextColor').value,
                        border_color: document.getElementById('settingsBorderColor').value,
                        background_color: document.getElementById('settingsBackgroundColor').value,
                        header_bg_color: document.getElementById('settingsHeaderBgColor').value,
                        secondary_color: document.getElementById('settingsSecondaryColor').value
                    }]);
                
                if (error) throw error;
                
                statusDiv.innerHTML = '<p style="color: #00ff88;">‚úÖ Color settings saved!</p>';
                
            } catch (error) {
                console.error('Save error:', error);
                statusDiv.innerHTML = `<p style="color: #ff4444;">‚ùå Error: ${error.message}</p>`;
            }
        }

        // Add sponsor
        async function addSponsor() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            const name = document.getElementById('sponsorName').value;
            const url = document.getElementById('sponsorUrl').value;
            const logoFile = document.getElementById('sponsorLogo').files[0];
            const statusDiv = document.getElementById('sponsorStatus');
            
            if (!name || !logoFile) {
                statusDiv.innerHTML = '<p style="color: #ff4444;">‚ö†Ô∏è Name and logo are required</p>';
                return;
            }
            
            statusDiv.innerHTML = '<p style="color: #ffaa00;">üì§ Uploading...</p>';
            
            try {
                // Upload logo
                const fileExt = logoFile.name.split('.').pop();
                const fileName = `${user.id}/sponsor-${Date.now()}.${fileExt}`;
                
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('sponsor-logos')
                    .upload(fileName, logoFile);
                
                if (uploadError) throw uploadError;
                
                const { data: urlData } = supabase.storage
                    .from('sponsor-logos')
                    .getPublicUrl(fileName);
                
                // Create sponsor record
                const { error } = await supabase
                    .from('sponsors')
                    .insert([{
                        user_id: user.id,
                        name: name,
                        logo_url: urlData.publicUrl,
                        website_url: url || null,
                        is_active: true
                    }]);
                
                if (error) throw error;
                
                statusDiv.innerHTML = '<p style="color: #00ff88;">‚úÖ Sponsor added!</p>';
                
                // Clear form
                document.getElementById('sponsorName').value = '';
                document.getElementById('sponsorUrl').value = '';
                document.getElementById('sponsorLogo').value = '';
                
                // Reload sponsors list
                await loadSponsors();
                
            } catch (error) {
                console.error('Add sponsor error:', error);
                statusDiv.innerHTML = `<p style="color: #ff4444;">‚ùå Error: ${error.message}</p>`;
            }
        }

        // Load sponsors list
        async function loadSponsors() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            try {
                const { data, error } = await supabase
                    .from('sponsors')
                    .select('*')
                    .eq('user_id', user.id)
                    .order('display_order', { ascending: true });
                
                if (error) throw error;
                
                const listDiv = document.getElementById('sponsorsList');
                
                if (!data || data.length === 0) {
                    listDiv.innerHTML = '<p style="color: #888;">No sponsors added yet</p>';
                    return;
                }
                
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">';
                
                data.forEach(sponsor => {
                    html += `
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; border: 1px solid #333; text-align: center;">
                            <img src="${sponsor.logo_url}" style="max-width: 100%; max-height: 80px; margin-bottom: 10px;">
                            <p style="font-weight: bold; margin-bottom: 5px;">${sponsor.name}</p>
                            ${sponsor.website_url ? `<p style="font-size: 0.8em; color: #888; word-break: break-all;">${sponsor.website_url}</p>` : ''}
                            <button onclick="deleteSponsor('${sponsor.id}')" class="btn" style="background: #dc3545; font-size: 0.8em; padding: 5px 10px; margin-top: 10px;">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    `;
                });
                
                html += '</div>';
                listDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Load sponsors error:', error);
            }
        }

        // === SERIES MANAGEMENT FUNCTIONS ===
        
        // Load all series for current user
        async function loadSeries() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            try {
                const { data, error } = await supabase
                    .from('series')
                    .select('*')
                    .eq('user_id', user.id)
                    .order('display_order', { ascending: true });
                
                if (error) throw error;
                
                const listDiv = document.getElementById('seriesList');
                
                if (!data || data.length === 0) {
                    listDiv.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">No series created yet. Add your first series above!</p>';
                    return;
                }
                
                let html = '';
                data.forEach((series, index) => {
                    const isTocBadge = series.is_toc ? '<span style="background: #ffd700; color: #000; padding: 2px 8px; border-radius: 3px; font-size: 0.8em; margin-left: 10px;">üèÜ TOC</span>' : '';
                    const displayBadge = series.is_displayed ? 
                        '<span style="background: #28a745; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 0.8em; margin-left: 5px;">üëÅÔ∏è Visible</span>' :
                        '<span style="background: #6c757d; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 0.8em; margin-left: 5px;">üö´ Hidden</span>';
                    
                    html += `
                        <div style="background: rgba(100, 149, 237, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(100, 149, 237, 0.3); margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; color: #6495ED;">${series.name}${isTocBadge}${displayBadge}</h4>
                                    <p style="margin: 0; color: #888; font-size: 0.9em;">üìä ${series.num_events} event${series.num_events > 1 ? 's' : ''}</p>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="toggleSeriesDisplay('${series.id}', ${!series.is_displayed})" class="btn" 
                                        style="background: ${series.is_displayed ? '#6c757d' : '#28a745'}; font-size: 0.85em; padding: 8px 12px;">
                                        ${series.is_displayed ? 'üö´ Hide' : 'üëÅÔ∏è Show'}
                                    </button>
                                    <button onclick="deleteSeries('${series.id}')" class="btn" style="background: #dc3545; font-size: 0.85em; padding: 8px 12px;">
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                listDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Load series error:', error);
                document.getElementById('seriesList').innerHTML = 
                    `<p style="color: #ff4444; text-align: center; padding: 20px;">‚ùå Error loading series: ${error.message}</p>`;
            }
        }
        
        // Add new series
        async function addSeries() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;
            
            const name = document.getElementById('newSeriesName').value.trim();
            const numEvents = parseInt(document.getElementById('newSeriesNumEvents').value);
            const isToc = document.getElementById('newSeriesIsToc').checked;
            const isDisplayed = document.getElementById('newSeriesDisplay').checked;
            
            if (!name) {
                alert('‚ö†Ô∏è Please enter a series name');
                return;
            }
            
            if (!numEvents || numEvents < 1) {
                alert('‚ö†Ô∏è Please enter a valid number of events');
                return;
            }
            
            try {
                // Get current max display_order
                const { data: existing } = await supabase
                    .from('series')
                    .select('display_order')
                    .eq('user_id', user.id)
                    .order('display_order', { ascending: false })
                    .limit(1);
                
                const displayOrder = existing && existing.length > 0 ? existing[0].display_order + 1 : 0;
                
                const { error } = await supabase
                    .from('series')
                    .insert({
                        user_id: user.id,
                        name: name,
                        num_events: numEvents,
                        is_toc: isToc,
                        is_displayed: isDisplayed,
                        display_order: displayOrder
                    });
                
                if (error) throw error;
                
                // Clear form
                document.getElementById('newSeriesName').value = '';
                document.getElementById('newSeriesNumEvents').value = '5';
                document.getElementById('newSeriesIsToc').checked = false;
                document.getElementById('newSeriesDisplay').checked = true;
                
                // Reload series list
                await loadSeries();
                
                // Show success message briefly
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 15px 20px; border-radius: 5px; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.3);';
                successMsg.textContent = '‚úÖ Series added successfully!';
                document.body.appendChild(successMsg);
                setTimeout(() => successMsg.remove(), 3000);
                
            } catch (error) {
                console.error('Add series error:', error);
                alert(`‚ùå Error adding series: ${error.message}`);
            }
        }
        
        // Toggle series display on/off
        async function toggleSeriesDisplay(seriesId, newDisplayState) {
            try {
                const { error } = await supabase
                    .from('series')
                    .update({ is_displayed: newDisplayState })
                    .eq('id', seriesId);
                
                if (error) throw error;
                
                await loadSeries();
                
            } catch (error) {
                console.error('Toggle series error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }
        
        // Delete series
        async function deleteSeries(seriesId) {
            if (!confirm('‚ö†Ô∏è Delete this series? This action cannot be undone.')) return;
            
            try {
                const { error } = await supabase
                    .from('series')
                    .delete()
                    .eq('id', seriesId);
                
                if (error) throw error;
                
                await loadSeries();
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 15px 20px; border-radius: 5px; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.3);';
                successMsg.textContent = '‚úÖ Series deleted';
                document.body.appendChild(successMsg);
                setTimeout(() => successMsg.remove(), 3000);
                
            } catch (error) {
                console.error('Delete series error:', error);
                alert(`‚ùå Error: ${error.message}`);
            }
        }
        
        // === SPONSOR MANAGEMENT FUNCTIONS ===
        
        // Delete sponsor
        async function deleteSponsor(sponsorId) {
            if (!confirm('Delete this sponsor?')) return;
            
            try {
                const { error } = await supabase
                    .from('sponsors')
                    .delete()
                    .eq('id', sponsorId);
                
                if (error) throw error;
                
                await loadSponsors();
                
            } catch (error) {
                console.error('Delete sponsor error:', error);
                alert('Error deleting sponsor: ' + error.message);
            }
        }

        // Copy display URL
        function copyDisplayUrl() {
            const input = document.getElementById('displayUrlInput');
            input.select();
            input.setSelectionRange(0, 99999);
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(input.value).then(() => {
                    alert('‚úÖ Display URL copied to clipboard!');
                }).catch(() => {
                    document.execCommand('copy');
                    alert('‚úÖ Display URL copied to clipboard!');
                });
            } else {
                document.execCommand('copy');
                alert('‚úÖ Display URL copied to clipboard!');
            }
        }

        // Add Enter key support for login
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('loginPassword');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleLogin();
                    }
                });
            }
            
            const signupPasswordConfirm = document.getElementById('signupPasswordConfirm');
            if (signupPasswordConfirm) {
                signupPasswordConfirm.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleSignup();
                    }
                });
            }
        });
    </script>
</body>
</html>